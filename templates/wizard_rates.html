{% extends "base.html" %}
{% from "_formhelpers.html" import render_field, render_submit_field, render_field_list_item %}

{% block title %}{{ title }} - {{ super() }}{% endblock %}

{% block content %}
  <h2>{{ title }}</h2>
  <p>{{ _("Define your expected investment returns and inflation. You can also specify different return rates for distinct periods if needed.") }}</p>
  <form method="POST" action="{{ url_for('wizard_bp.wizard_rates_step') }}" novalidate>
    {{ form.csrf_token }}
    <fieldset>
      <legend class="visually-hidden">{{ _("Rates Form") }}</legend>
      {{ render_field(form.return_rate, class="form-control", placeholder=_("e.g., 7")) }}
      {{ render_field(form.inflation_rate, class="form-control", placeholder=_("e.g., 2.5")) }}

      {{ render_field(form.total_duration_fallback, class="form-control", placeholder=_("e.g., 30")) }}
      {{ render_field(form.desired_final_value, class="form-control", placeholder=_("e.g., 0")) }}

      <div class="mb-3">
        {{ form.withdrawal_time.label(class="form-label") }}
        {% for subfield in form.withdrawal_time %}
          <div class="form-check">
            {{ subfield(class="form-check-input") }}
            {{ subfield.label(class="form-check-label") }}
          </div>
        {% endfor %}
        {% if form.withdrawal_time.errors %}
          <div class="invalid-feedback d-block">
            {% for error in form.withdrawal_time.errors %}
              <span>{{ error }}</span><br>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <h4 class="mt-4">{{ _("Period-Specific Return Rates (Optional)") }}</h4>
      <p><small>{{_("If you expect your investment return rate to change over time (e.g., lower returns in retirement), define those periods here. Otherwise, leave blank.")}}</small></p>
      <div id="period-rates-list">
        {% for period_form in form.period_rates %}
          {{ render_field_list_item(period_form, loop.index0, 'period_rates', ['years', 'rate']) }}
        {% endfor %}
      </div>
      {{ render_submit_field(form.submit_add_period, class="btn btn-secondary btn-sm mt-2", formnovalidate=True) }}
    </fieldset>
    {{ render_submit_field(form.submit, class="btn btn-primary mt-3") }}
  </form>
{% endblock %}
