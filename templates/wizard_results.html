{% extends "base.html" %}

{% block title %}{{ title }} - {{ super() }}{% endblock %}

{% block content %}
  <h2>{{ title }}</h2>

  <div class="alert alert-info" role="alert">
    <p>{{_("This is a placeholder results page. Full calculation logic and result presentation are being implemented.")}}</p>
  </div>

  <h3>{{_("Summary of Inputs Used:")}}</h3>
  <ul>
    <li>{{_("Annual Expenses (W):")}} {{ W | default(0) }}</li>
    <li>{{_("Overall Nominal Return Rate:")}} {{ (r_overall_nominal * 100) | round(2) }}%</li>
    <li>{{_("Overall Inflation Rate:")}} {{ (i_overall * 100) | round(2) }}%</li>
    <li>{{_("Total Duration (from periods):")}} {{ total_duration_from_periods }} {{_("years")}}</li>
    <li>{{_("Withdrawal Timing:")}} {{ withdrawal_time_str | capitalize }}</li>
    <li>{{_("Desired Final Portfolio Value:")}} {{ desired_final_value | default(0) }}</li>
  </ul>

  {% if itemized_expenses_summary and itemized_expenses_summary is mapping and itemized_expenses_summary.get('housing') is not none %} {# Check if data is available and seems like the dict #}
  <div class="card mt-3 mb-3">
    <div class="card-header">
      <h4>{{ _("Itemized Expenses Breakdown (Input)") }}</h4>
    </div>
    <ul class="list-group list-group-flush">
      {# Only display if value is not None; default to 0 if key exists but is None for display #}
      {% set expense_keys = ['housing', 'food', 'transportation', 'utilities', 'personal_care', 'entertainment', 'healthcare', 'other_expenses'] %}
      {% for key in expense_keys %}
        {% if itemized_expenses_summary.get(key) is not none %}
          <li class="list-group-item"><strong>{{ _(key.replace('_', ' ').title() + ":") }}</strong> {{ itemized_expenses_summary.get(key) | default(0.0) }}</li>
        {% endif %}
      {% endfor %}
      {# The total 'annual_expenses' from this dict is already shown as W_display or W #}
    </ul>
  </div>
  {% endif %}

  <h4>{{_("Rates Periods Used:")}}</h4>
  {% if rates_periods_summary %}
    <ul>
    {% for p in rates_periods_summary %}
      <li>{{_("Duration:")}} {{ p.duration }} {{_("years")}}, {{_("Nominal Rate:")}} {{ (p.r * 100) | round(2) }}%, {{_("Inflation:")}} {{ (p.i * 100) | round(2) }}%</li>
    {% endfor %}
    </ul>
  {% else %}
    <p>{{_("No specific rate periods defined (used overall rates for total duration).")}}</p>
  {% endif %}

  <h4>{{_("One-Off Events Considered:")}}</h4>
  {% if one_off_events_summary %}
    <ul>
    {% for e in one_off_events_summary %}
      <li>{{_("Year:")}} {{ e.year }}, {{_("Amount:")}} {{ e.amount }}</li>
    {% endfor %}
    </ul>
  {% else %}
    <p>{{_("No one-off events.")}}</p>
  {% endif %}

  <hr>
  <h3>{{_("Calculation Results:")}}</h3>
  {% if error_message %}
    <div class="alert alert-danger" role="alert">
      <h4>{{_("Calculation Error")}}</h4>
      <p>{{ error_message }}</p>
    </div>
  {% endif %}
  <p><strong>{{_("Initial Annual Expenses (W):")}}</strong> {{ W_display | default(W) }}</p> {# W_display is preferred, fallback to W #}
  <p><strong>{{_("Calculated Required Initial Portfolio (FIRE Number):")}}</strong> {{ P_calculated_display }}</p>

  <div class="mt-3">
    {{ plot1_div | safe }}
  </div>
  <div class="mt-3">
    {{ plot2_div | safe }}
  </div>

  <h4>{{_("Year-by-Year Simulation:")}}</h4>
  {% if table_rows %}
  <div class="mt-3 table-responsive">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>{{_("Year")}}</th>
          <th>{{_("End of Year Portfolio Balance")}}</th>
          <th>{{_("Annual Withdrawal")}}</th>
        </tr>
      </thead>
      <tbody>
        {% for row in table_rows %}
        <tr>
          <td>{{ row.year }}</td>
          <td>{{ row.balance }}</td> {# Assuming currency symbol will be handled by f-string or app global formatter #}
          <td>{{ row.withdrawal }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% elif not error_message %} {# Only show "not available" if there wasn't a calculation error reported #}
  <p>{{_("Simulation data not available.")}}</p>
  {% endif %}

  <div class="mt-4">
    <a href="{{ url_for('wizard_bp.wizard_expenses_step') }}" class="btn btn-secondary">{{ _("Start New Wizard") }}</a>
    <a href="{{ url_for('project.index') }}" class="btn btn-info">{{ _("Back to Home") }}</a>
  </div>

{% endblock %}
