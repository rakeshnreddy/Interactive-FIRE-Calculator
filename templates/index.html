{% extends "base.html" %}

{% block title %}{{ _("FIRE Calculator - Home") }}{% endblock %}

{% block content %}
  <div class="container index-page"> <!-- .index-page class is already here -->
    <h2>{{ _("Enter Your Details") }}</h2>
    {% if error %}
      <div class="alert alert-danger">{{ error }}</div> {# Error messages from backend are already translated #}
    {% endif %}
    <form method="post" action="{{ url_for('project.index') }}" class="needs-validation" novalidate id="calculatorForm">
      <div class="mb-3">
        <label for="W" class="form-label">{{ _("Annual Expenses (in today's dollars):") }}<span class="info-icon">&#9432;<span class="tooltip-text">{{ _("Your estimated current annual living expenses.") }}</span></span></label>
        <input type="number" name="W" id="W" class="form-control" value="{{ request.form.get('W', defaults.W) }}" required min="0">
      </div>

      <div class="mb-3">
        <label for="r" class="form-label">{{ _("Overall Annual Return (%%) (Fallback):") }}<span class="info-icon">&#9432;<span class="tooltip-text">{{ _("Expected average annual investment return (e.g., 7%% for 7). Used if no specific periods are defined.") }}</span></span></label>
        <input type="number" name="r" id="r" class="form-control" step="0.1" value="{{ request.form.get('r', defaults.r) }}" min="-50" max="100">
        <small class="form-text text-muted">{{ _("Used if no periodic rates are specified below.") }}</small>
      </div>
      <div class="mb-3">
        <label for="i" class="form-label">{{ _("Overall Annual Inflation (%%) (Fallback):") }}<span class="info-icon">&#9432;<span class="tooltip-text">{{ _("Expected average annual inflation rate (e.g., 3%% for 3). Used if no specific periods are defined.") }}</span></span></label>
        <input type="number" name="i" id="i" class="form-control" step="0.1" value="{{ request.form.get('i', defaults.i) }}" min="-50" max="100">
        <small class="form-text text-muted">{{ _("Used if no periodic rates are specified below.") }}</small>
      </div>
      <div class="mb-3">
        <label for="T" class="form-label">{{ _("Total Duration (years) (Fallback):") }}<span class="info-icon">&#9432;<span class="tooltip-text">{{ _("How many years your retirement funds need to last. Used if no specific periods are defined.") }}</span></span></label>
        <input type="number" name="T" id="T" class="form-control" value="{{ request.form.get('T', defaults.T) }}" min="1" step="1">
        <small class="form-text text-muted">{{ _("Used if no periodic rates are specified below. If using periods, total duration is sum of period durations.") }}</small>
      </div>

      <hr>
      <h3>{{ _("Periodic Rate Configuration (Optional)") }}</h3>
      <p><small class="form-text text-muted">{{ _("If any period duration is specified, these periodic rates will override the overall fallback rates above. Unspecified periods will be ignored.") }}</small></p>

      {% for k in range(1, 4) %}
      <div class="period-group row gx-2 mb-2">
        <div class="col">
          <label for="period{{k}}_duration" class="form-label form-label-sm">{{ _("P") }}{{k}} {{ _("Dur.:") }}<span class="info-icon">&#9432;<span class="tooltip-text">{{ _("Duration (in years) for this specific period.") }}</span></span></label>
          <input type="number" name="period{{k}}_duration" id="period{{k}}_duration" class="form-control form-control-sm" value="{{ request.form.get('period{}_duration'.format(k)) or defaults['period{}_duration'.format(k)] }}" min="0" step="1" placeholder="{{ _('Years') }}">
        </div>
        <div class="col">
          <label for="period{{k}}_r" class="form-label form-label-sm">{{ _("P") }}{{k}} {{ _("Ret(%%):") }}<span class="info-icon">&#9432;<span class="tooltip-text">{{ _("Expected annual investment return for this period.") }}</span></span></label>
          <input type="number" name="period{{k}}_r" id="period{{k}}_r" class="form-control form-control-sm" step="0.1" value="{{ request.form.get('period{}_r'.format(k)) or defaults['period{}_r'.format(k)] }}" min="-50" max="100" placeholder="%">
        </div>
        <div class="col">
          <label for="period{{k}}_i" class="form-label form-label-sm">{{ _("P") }}{{k}} {{ _("Inf(%%):") }}<span class="info-icon">&#9432;<span class="tooltip-text">{{ _("Expected annual inflation rate for this period.") }}</span></span></label>
          <input type="number" name="period{{k}}_i" id="period{{k}}_i" class="form-control form-control-sm" step="0.1" value="{{ request.form.get('period{}_i'.format(k)) or defaults['period{}_i'.format(k)] }}" min="-50" max="100" placeholder="%">
        </div>
      </div>
      {% endfor %}
      <hr>

      <div class="mb-3"> {# Changed from form-group radio-group #}
        <label class="form-label">{{ _("Withdrawal Timing:") }}<span class="info-icon">&#9432;<span class="tooltip-text">{{ _("Choose whether withdrawals occur at the start or end of each year.") }}</span></span></label> {# Main label for the group #}
        <div class="form-check">
            <input class="form-check-input" type="radio" name="withdrawal_time" value="start" id="start" {% if request.form.get('withdrawal_time', defaults.withdrawal_time) == 'start' %}checked{% endif %}>
            <label class="form-check-label" for="start">{{ _("Start of Year") }}</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="withdrawal_time" value="end" id="end" {% if request.form.get('withdrawal_time', defaults.withdrawal_time) == 'end' or not request.form.get('withdrawal_time', defaults.withdrawal_time) %}checked{% endif %}>
            <label class="form-check-label" for="end">{{ _("End of Year") }}</label>
        </div>
      </div>
      <div class="mb-3">
        <label for="D" class="form-label">{{ _("Desired Final Portfolio Value") }} ({{ DEFAULT_CURRENCY }}):<span class="info-icon">&#9432;<span class="tooltip-text">{{ _("The amount you wish to have remaining at the end of the retirement duration. Default is $0.") }}</span></span></label>
        <input type="number" name="D" id="D" class="form-control" value="{{ request.form.get('D', defaults.D) }}" step="any" min="0">
        <small class="form-text text-muted">{{ _("Optional. The portfolio value you want remaining at the end of the term.") }}</small>
      </div>
      <button type="submit" class="btn btn-primary">{{ _("Calculate") }}</button>
    </form>
    <div class="mt-4 text-center"> {# Added margin and text centering for the link/button #}
      <a href="{{ url_for('project.compare') }}" class="btn btn-secondary">{{ _("Compare Scenarios") }}</a>
    </div>
  </div>
{% endblock %}
