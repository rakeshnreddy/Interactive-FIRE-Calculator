{% extends "base.html" %}

{% block title %}Settings - FIRE Calculator{% endblock %}

{% block content %}
<div class="container settings-page">
  <h2>Settings</h2>
  
  <div class="mb-3">
    <label for="themeSelect" class="form-label">Select Default Theme:</label>
    <select id="themeSelect" class="form-select" required>
      <option value="light">Light</option>
      <option value="dark">Dark</option>
      {# Add other theme options here if main.css supports them and theme.js handles them #}
      {# e.g. <option value="pastel">Pastel</option> #}
    </select>
    <small class="form-text text-muted">This sets the default theme preference. The toggle button in the navbar provides immediate switching.</small>
  </div>
  
  <div class="mb-3">
    <label for="fontSize" class="form-label">Font Size (px):</label>
    <input type="number" id="fontSize" class="form-control" value="16" min="10" max="24" step="1" required>
    <small class="form-text text-muted">Changes the base font size across the application (Default: 16px).</small>
  </div>
  
  <div class="mb-3">
    <label for="panelOpacity" class="form-label">Panel Opacity (0-1):</label>
    <input type="range" id="panelOpacity" class="form-range" min="0.1" max="1.0" step="0.05" value="0.85" required> 
    <small class="form-text text-muted">Adjusts the transparency of UI panels (e.g., cards, modals if used).</small>
  </div>
  
  <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
  <p class="mt-2"><small>Settings are saved in your browser's local storage.</small></p>
  
  <div class="mt-4">
    <a href="{{ url_for('routes.index') }}" class="btn btn-outline-secondary">‚Üê Back to Calculator</a>
  </div>
</div>
{% endblock %}

{% block scripts_extra %}
<script>
  function saveSettings() {
    const theme = document.getElementById("themeSelect").value;
    const fontSize = document.getElementById("fontSize").value;
    const panelOpacity = document.getElementById("panelOpacity").value;
    
    // Save the theme preference for Bootstrap (used by theme.js)
    localStorage.setItem('theme', theme); 
    
    // Save other settings
    const settings = { fontSize, panelOpacity };
    localStorage.setItem("fireSettings", JSON.stringify(settings));
    
    applySettings(); // Apply all settings including the new theme state
    
    // Provide feedback to user
    // Create a temporary message
    let msgDiv = document.createElement('div');
    msgDiv.className = 'alert alert-success alert-dismissible fade show fixed-top m-3';
    msgDiv.setAttribute('role', 'alert');
    msgDiv.innerHTML = 'Settings saved successfully! <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>';
    document.body.appendChild(msgDiv);
    // Automatically remove the message after a few seconds
    setTimeout(() => {
        let alertNode = bootstrap.Alert.getInstance(msgDiv);
        if(alertNode) alertNode.close(); else if(msgDiv.parentNode) msgDiv.parentNode.removeChild(msgDiv);
    }, 3000);
  }
  
  function applyPageSpecificSettings() {
    // applyTheme() is called from base.html

    // Apply font size and panel opacity specifically
    const fireSettingsSaved = localStorage.getItem("fireSettings");
    if (fireSettingsSaved) {
      const settings = JSON.parse(fireSettingsSaved);
      if (settings.fontSize) {
        document.documentElement.style.setProperty("--bs-body-font-size", (parseInt(settings.fontSize) / 16) + "rem");
        // If you have other elements that don't inherit --bs-body-font-size, you might need more specific selectors
      }
      if (settings.panelOpacity) {
        // This assumes you have CSS variables for panel background that includes an alpha channel
        // For example, in main.css: .card { background-color: rgba(var(--bs-tertiary-bg-rgb), var(--panel-alpha)); }
        document.documentElement.style.setProperty("--panel-alpha", settings.panelOpacity);
      }
    }
  }

  document.addEventListener("DOMContentLoaded", function() {
      // applyTheme() is already called in base.html, so it should have set the Bootstrap theme attribute
      applyPageSpecificSettings(); // Apply other page-specific settings like font size, opacity

      // Initialize form controls with saved values
      const savedTheme = localStorage.getItem('theme'); // This is for Bootstrap theme
      if (savedTheme) {
          document.getElementById("themeSelect").value = savedTheme;
      }

      const fireSettingsSaved = localStorage.getItem("fireSettings");
      if (fireSettingsSaved) {
          const settings = JSON.parse(fireSettingsSaved);
          if (settings.fontSize) {
              document.getElementById("fontSize").value = settings.fontSize;
          }
          if (settings.panelOpacity) {
              document.getElementById("panelOpacity").value = settings.panelOpacity;
          }
      }
  });
</script>
{% endblock %}
